services:
  # Preprocessing service
  preprocess:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pdm_preprocess
    volumes:
      - ./src:/app/src:ro
      - ./data/raw:/app/data/raw:ro
      - ./data/processed:/app/data/processed:rw
    environment:
      - PYTHONPATH=/app
    working_dir: /app
    command: ["python", "-m", "src.preprocessing.data_merger"]

  # Algorithm runner service
  algorithms:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pdm_algorithms
    volumes:
      - ./src:/app/src:ro
      - ./results:/app/results:rw
    environment:
      - PYTHONPATH=/app
    working_dir: /app
    command: ["python", "-m", "src.algorithms.algorithm_runner", "--all"]

  # Stability analysis service
  analysis:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pdm_analysis
    volumes:
      - ./src:/app/src:ro
      - ./results:/app/results:rw
    environment:
      - PYTHONPATH=/app
    working_dir: /app
    command: ["python", "-m", "src.analysis.stability_calculator"]

  # Visualization service
  visualize:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: pdm_visualize
    volumes:
      - ./src:/app/src:ro
      - ./results:/app/results:rw
    environment:
      - PYTHONPATH=/app
    working_dir: /app
    command: ["python", "-m", "src.visualization.plot_results"]

# Network configuration
networks:
  default:
    name: pdm_network
